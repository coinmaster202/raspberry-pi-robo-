<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Secure Motion Assistant</title>
  <style>
    body {
      background: #000;
      color: lime;
      font-family: monospace;
      padding: 20px;
    }
    #console {
      background: #111;
      padding: 15px;
      min-height: 300px;
      border-radius: 10px;
      white-space: pre-wrap;
    }
    input, button {
      margin-top: 10px;
      padding: 10px;
      font-size: 16px;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 999;
      color: white;
      text-align: center;
      padding-top: 100px;
    }
    #overlay-content {
      display: inline-block;
      background: #300;
      border: 2px solid red;
      padding: 30px;
      border-radius: 15px;
      font-size: 18px;
    }
    #overlay input {
      padding: 8px;
      margin-top: 10px;
      width: 200px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>üîê Secure Motion Assistant</h1>
  <button onclick="startInteraction()">üëã Simulate Motion Detected</button>
  <div id="console"></div>

  <div id="input-area" style="display:none;">
    <input id="user-input" placeholder="Type your response..." onkeydown="if(event.key==='Enter'){handleInput()}" />
    <button onclick="handleInput()">Submit</button>
  </div>

  <div id="overlay">
    <div id="overlay-content">
      <h2>üö® Terminal Locked</h2>
      <p>This message has been flagged as inappropriate and blocked.</p>
      <p>Access has been restricted. Please contact support to unlock this terminal.</p>
      <p>Enter unlock code to continue:</p>
      <input id="unlock-code" type="text" placeholder="Enter code here" onkeydown="if(event.key==='Enter'){submitUnlock()}" />
      <br>
      <button onclick="submitUnlock()">Unlock</button>
    </div>
    <audio id="siren" src="https://www.soundjay.com/misc/sounds/siren-noise-01.mp3" autoplay loop></audio>
  </div>

  <a id="log-download" style="display:none;"></a>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const consoleEl = document.getElementById('console');
      const inputArea = document.getElementById('input-area');
      const userInput = document.getElementById('user-input');
      const overlay = document.getElementById('overlay');
      const logDownload = document.getElementById('log-download');
      const unlockInput = document.getElementById('unlock-code');
      const sirenAudio = document.getElementById('siren');

      const profanityList = ["tits","bitch","fuck","shit","dick","cunt","asshole", ... ]; // shortened for brevity

      let currentState = null;
      let userName = "";
      let asked = new Set();
      let availableOptions = ["1", "2", "3", "4", "5"];
      let locked = false;
      let logEntry = "";
      let chatMessages = [];
      let chatCount = 0;

      const UNLOCK_CODE = "2026";

      async function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function speak(text) {
        consoleEl.innerHTML += `ü§ñ: ${text}\n`;
        consoleEl.scrollTop = consoleEl.scrollHeight;
        return new Promise(resolve => {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'en-US';
          utterance.rate = 1;
          utterance.onend = resolve;
          speechSynthesis.speak(utterance);
        });
      }

      function listen(state) {
        currentState = state;
        inputArea.style.display = 'block';
        userInput.value = '';
        userInput.focus();
      }

      async function triggerLockdown(badInput = "") {
        locked = true;
        overlay.style.display = "block";
        logEntry = `üö® Profanity Detected: "${badInput}"\nTime: ${new Date().toLocaleString()}`;
        await speak("‚ö†Ô∏è This message has been flagged as inappropriate and blocked.");
        await speak("Access has been restricted. Please contact support to unlock this terminal.");
        await speak("Enter unlock code to continue.");
        downloadLog();
        unlockInput.focus();
      }

      function isProfane(input) {
        return profanityList.some(word => input.includes(word));
      }

      function submitUnlock() {
        const input = unlockInput.value.trim();
        if (input === UNLOCK_CODE) {
          overlay.style.display = "none";
          locked = false;
          logDownload.style.display = 'none';
          sirenAudio.pause();
          sirenAudio.currentTime = 0;
          speak("‚úÖ Unlock code accepted. Terminal access restored.");
          startInteraction();
        } else {
          speak("‚ùå Invalid unlock code. Access remains restricted.");
        }
      }

      function downloadLog() {
        const blob = new Blob([logEntry], { type: 'text/plain' });
        logDownload.href = URL.createObjectURL(blob);
        logDownload.download = "lockdown-log.txt";
        logDownload.style.display = 'inline';
        logDownload.textContent = "‚¨áÔ∏è Download Lockdown Log";
      }

      async function startInteraction() {
        if (locked) return;
        consoleEl.innerHTML = '';
        asked.clear();
        chatMessages = [];
        chatCount = 0;
        availableOptions = ["1", "2", "3", "4", "5"];
        await speak("Hello! I see someone just arrived.");
        await speak("Welcome to my interactive assistant.");
        showMenu();
      }

      async function showMenu() {
        const remaining = availableOptions.filter(opt => !asked.has(opt));
        if (remaining.length === 0) {
          await speak("You've completed all options. Restarting in 5 seconds...");
          setTimeout(startInteraction, 5000);
          return;
        }
        await speak("Please choose one of the following options:");
        for (const opt of remaining) {
          if (opt === "1") await speak("1. What is your name?");
          if (opt === "2") await speak("2. How are you?");
          if (opt === "3") await speak("3. Try a math trick");
          if (opt === "4") await speak("4. Exit");
          if (opt === "5") await speak("5. Ask anything (ChatGPT mode)");
        }
        listen("menu");
      }

      async function handleInput() {
        const input = userInput.value.trim().toLowerCase();
        consoleEl.innerHTML += `You: ${input}\n`;
        inputArea.style.display = 'none';

        if (isProfane(input)) {
          await triggerLockdown(input);
          return;
        }

        switch (currentState) {
          case "menu":
            if (!availableOptions.includes(input) || asked.has(input)) {
              await speak("That option is not available or already used.");
              showMenu();
              return;
            }
            asked.add(input);
            if (input === "1") { await speak("What is your name?"); listen("getName"); }
            else if (input === "2") { await speak("How are you feeling today?"); listen("getMood"); }
            else if (input === "3") { await mathTrick(); showMenu(); }
            else if (input === "4") { await speak("Goodbye! Restarting soon..."); setTimeout(startInteraction, 5000); }
            else if (input === "5") {
              chatMessages = [{ role: "system", content: "You are a helpful assistant." }];
              chatCount = 0;
              await speak("You can now ask anything! You have 5 questions.");
              listen("chatMode");
            }
            break;

          case "getName":
            if (isProfane(input)) return await triggerLockdown(input);
            userName = input;
            await speak(`Nice to meet you, ${userName}`);
            showMenu();
            break;

          case "getMood":
            if (isProfane(input)) return await triggerLockdown(input);
            await speak("Thanks for sharing that with me.");
            showMenu();
            break;

          case "chatMode":
            chatMessages.push({ role: "user", content: input });
            try {
              const response = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ messages: chatMessages })
              });
              const data = await response.json();
              const reply = data.reply;
              chatMessages.push({ role: "assistant", content: reply });
              await speak(reply);
            } catch {
              await speak("Sorry, I couldn't connect to the assistant.");
            }
            chatCount++;
            if (chatCount >= 5) {
              await speak("That was your last question. Returning to menu...");
              showMenu();
            } else {
              listen("chatMode");
            }
            break;
        }
      }

      async function mathTrick() {
        await speak("Let's do a fun mind trick.");
        await delay(1000);
        await speak("Think of a number.");
        await delay(1300);
        await speak("Double it.");
        await delay(1300);
        await speak("Add 10.");
        await delay(1300);
        await speak("Divide by 2.");
        await delay(1300);
        await speak("Subtract your original number.");
        await delay(1600);
        await speak("The answer is... 5! üòÑ");
      }

      window.startInteraction = startInteraction;
      window.submitUnlock = submitUnlock;
      window.handleInput = handleInput;
    });
  </script>
</body>
</html>
